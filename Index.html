<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›ªåœ‹è¡Œç¨‹èˆ‡è¨˜å¸³ Master</title>
    <style>
        :root { --gold: #D4AF37; --brown: #3E2723; --bg: #FDFBF7; --card: #FFFFFF; }
        body { margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--brown); padding-bottom: 80px; }
        .header { background: #fff; padding: 15px; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; }
        .btn { background: var(--gold); color: white; border: none; padding: 6px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .content { padding: 15px; }
        .day-group { margin-bottom: 30px; }
        .day-title { font-size: 1.3rem; font-weight: bold; border-left: 6px solid var(--gold); padding-left: 12px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; background: #eee; padding-top:5px; padding-bottom:5px; }
        .step-card { background: var(--card); border-radius: 8px; margin-bottom: 10px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .step-header { padding: 12px 15px; display: flex; align-items: center; cursor: pointer; }
        .step-time { font-family: monospace; font-weight: bold; color: var(--gold); min-width: 110px; font-size: 0.85rem; }
        .step-name { flex-grow: 1; font-weight: 500; font-size: 0.95rem; }
        .step-body { padding: 15px; display: none; border-top: 1px dashed #ddd; background: #fffdf9; }
        .step-body.active { display: block; }
        .section-title { font-weight: bold; font-size: 0.85rem; margin: 10px 0 5px; color: #777; border-bottom: 1px solid #eee; }
        .edit-input { width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .todo-item { display: flex; align-items: center; margin: 5px 0; font-size: 0.9rem; }
        .exp-list-item { display: flex; justify-content: space-between; background: #eee; padding: 4px 8px; border-radius: 4px; margin-bottom: 4px; font-size: 0.85rem; }
        .nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; border-top: 1px solid var(--gold); height: 65px; z-index: 1000; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="header">
    <div id="status-text">é›ªåœ‹ä¹‹æ—… 2025</div>
    <div><button class="btn" onclick="toggleEdit()">ç·¨è¼¯æ¨¡å¼</button></div>
</div>

<div id="main-view" class="content"></div>
<div id="summary-view" class="content hidden">
    <div class="day-title">æ—…é€”ç¸½çµç®—</div>
    <div id="sum-stats"></div>
</div>

<div class="nav">
    <div class="nav-btn" onclick="showTab('main')">ğŸ—“ è¡Œç¨‹åˆ—è¡¨</div>
    <div class="nav-btn" onclick="showTab('sum')">ğŸ“Š ç¸½çµç®—</div>
</div>

<script>
    const rate = 0.22;
    let isEditMode = false;
    
    const defaultTrip = [
        { date: "3/1 (æ—¥)", steps: [
            { time: "11:30 - 14:35", name: "æ¡ƒæ©Ÿ Check-in â” èµ·é£›", detail: "æŠµé”æ©Ÿå ´æ«ƒæª¯ï¼Œç¢ºèªç¶²å¡èˆ‡ä¿éšªã€‚", todos: ["æª¢æŸ¥è­·ç…§", "é ˜ç¶²å¡"], map: "æ¡ƒåœ’æ©Ÿå ´", expenses: [] },
            { time: "18:45 - 20:11", name: "æŠµé”ä»™å°æ©Ÿå ´ â” å‡ºç™¼ä»™å°è»Šç«™", detail: "é ˜è¡Œæå‡ºé—œï¼Œè³¼è²· JR Pass æˆ–å„²å€¼ Suicaã€‚", todos: ["è²·JR Pass"], map: "ä»™å°æ©Ÿå ´", expenses: [] },
            { time: "20:35 - 21:25", name: "æŠµé”ä»™å°è»Šç«™ â” è½‰ä¹˜å±±å½¢é«˜é€Ÿå·´å£«", detail: "ä»™å°ç«™è¥¿å£æ­ä¹˜ã€‚", todos: ["æ‰¾å·´å£«ç«™"], map: "ä»™å°é§…", expenses: [] },
            { time: "22:45 - 23:00", name: "æŠµé”å±±å½¢è»Šç«™ â” å…¥ä½å¤§å’Œ ROYNET", detail: "è¾¦ç†å…¥ä½ä¼‘æ¯ã€‚", todos: ["Check-in"], map: "å±±å½¢ç«™å‰å¤§å’ŒROYNETé…’åº—", expenses: [] }
        ]},
        { date: "3/2 (ä¸€)", steps: [
            { time: "06:50 - 08:00", name: "å±±å½¢ç«™ â” æŠµé”è—ç‹æº«æ³‰é›ªå ´", detail: "æ­ä¹˜å·´å£«ã€‚æŠµé”å¾Œå¯„è¡Œæã€å–é›ªå…·ã€æœƒé¢æ•™ç·´ã€‚", todos: ["ç§Ÿé›ªå…·", "æœƒé¢æ•™ç·´"], map: "è—ç‹æº«æ³‰", expenses: [] },
            { time: "13:00 - 16:30", name: "ä¸Šå±±æ»‘é›ªç·´åŠŸ â” ä¸‹å±±å›é£¯åº—", detail: "æ»‘é›ªè¨“ç·´ã€‚å…¥ä½é«˜å®®å“ˆè’™å¾·é…’åº—ã€‚", todos: ["æ»‘é›ªéŒ„å½±"], map: "é«˜å®®å“ˆè’™å¾·é…’åº—", expenses: [] },
            { time: "18:00 - 21:00", name: "æ™šé¤ â” é£¯åº—ä¼‘æ¯", detail: "æ³¡æº«æ³‰å›è¡€ã€‚", todos: ["æ³¡æº«æ³‰"], map: "é«˜å®®å“ˆè’™å¾·é…’åº—", expenses: [] }
        ]},
        { date: "3/3 (äºŒ)", steps: [
            { time: "07:00 - 09:00", name: "å‡ºé–€ â” å–é›ªå…·æœƒé¢æ•™ç·´ â” ä¸Šå±±", detail: "å…¨æ—¥æ»‘é›ªè¨“ç·´ã€‚", todos: ["ç·´ç¿’ S-turn"], map: "è”µç‹æ¸©æ³‰ã‚¹ã‚­ãƒ¼å ´", expenses: [] },
            { time: "16:30 - 21:00", name: "æ»‘é›ªçµæŸ â” æ™šé¤ â” é£¯åº—ä¼‘æ¯", detail: "å›é£¯åº—æ›è£ï¼Œä¼‘æ¯ã€‚", todos: ["è‚Œè‚‰èˆ’ç·©"], map: "é«˜å®®å“ˆè’™å¾·é…’åº—", expenses: [] }
        ]},
        { date: "3/4 (ä¸‰)", steps: [
            { time: "07:00 - 11:30", name: "å‡ºé–€ â” å±±å½¢ç«™ â” éŠ€å±±æº«æ³‰", detail: "è½‰æ­å…¬è»Šå‰å¾€éŠ€å±±æº«æ³‰é–‘æ™ƒã€‚", todos: ["æ‹éŠ€å±±é›ªæ™¯"], map: "éŠ€å±±æ¸©æ³‰", expenses: [] },
            { time: "11:30 - 12:30", name: "éŠ€å±±åˆé¤ â” ä¸‹å±±å›å±±å½¢", detail: "å±±å½¢å¸‚å€é€›è¡—ã€æ™šé¤ã€‚", todos: ["è²·ä¼´æ‰‹ç¦®"], map: "å±±å½¢å¸‚", expenses: [] },
            { time: "18:30 - 18:55", name: "è²·è»Šç¥¨ â” æœ«ç­è»Šå›è—ç‹æº«æ³‰", detail: "æ³¨æ„æœ«ç­è»Šæ™‚é–“ã€‚", todos: ["è²·å›ç¨‹ç¥¨"], map: "å±±å½¢é§…", expenses: [] }
        ]},
        { date: "3/5 (å››)", steps: [
            { time: "08:00 - 09:00", name: "å‡ºé–€ â” å–é›ªå…· â” ä¸Šå±±æ»‘é›ª", detail: "è‡ªä¸»ç·´ç¿’ã€‚", todos: ["è¤‡ç¿’æ•™ç·´å‹•ä½œ"], map: "è”µç‹æ¸©æ³‰ã‚¹ã‚­ãƒ¼å ´", expenses: [] },
            { time: "16:30 - 21:00", name: "æ»‘é›ªçµæŸ â” æ™šé¤ â” é£¯åº—ä¼‘æ¯", detail: "æœ€å¾Œä¸€æ™šåœ¨è—ç‹æº«æ³‰ã€‚", todos: ["æ”¶è¡Œæ"], map: "é«˜å®®å“ˆè’™å¾·é…’åº—", expenses: [] }
        ]},
        { date: "3/6 (äº”)", steps: [
            { time: "08:00 - 10:12", name: "ä¸‹å±± â” å±±å½¢è»Šç«™ â” JR å¾€ä»™å°", detail: "æ­ä¹˜ 10:12 çš„ JR å‰å¾€ä»™å°ã€‚", todos: ["æ³¨æ„å·´å£«æ™‚é–“"], map: "å±±å½¢é§…", expenses: [] },
            { time: "11:30 - 18:00", name: "æŠµé”ä»™å° â” åˆé¤ â” å¸‚å€é€›è¡—", detail: "ä»™å°å¸‚å€è³¼ç‰©ã€‚", todos: ["æ‰¾ç¾é£Ÿ"], map: "ä»™å°é§…", expenses: [] },
            { time: "18:00 - 21:00", name: "æœ‹å‹èšé¤ â” å…¥ä½æµ·èŒµå¨œé£¯åº—", detail: "æµ·èŒµå¨œé£¯åº—ä»™å°åœ‹åˆ†ç”ºã€‚", todos: ["Check-in"], map: "æµ·èŒµå¨œé£¯åº—ä»™å°åœ‹åˆ†ç”º", expenses: [] }
        ]},
        { date: "3/7 (å…­)", steps: [
            { time: "07:30 - 08:30", name: "å‡ºé–€ â” ä»™å°ç«™é›†åˆ â” è·Ÿåœ˜", detail: "å‰å¾€ç‹ç‹¸æ‘èˆ‡æ¾å³¶ä¸€æ—¥éŠã€‚", todos: ["æº–æ™‚æŠµé”"], map: "JRä»™å°é§…", expenses: [] },
            { time: "10:00 - 17:00", name: "ç‹ç‹¸æ‘ â” æ¾å³¶ â” å›ä»™å°", detail: "æ‹ç‹ç‹¸ã€åƒæ¾å³¶ç‰¡è £ã€‚", todos: ["è²·ç‹ç‹¸åŠé£¾"], map: "è”µç‹ç‹ç‹¸æ‘", expenses: [] },
            { time: "17:30 - 21:00", name: "æ™šé¤ â” å¸‚å€é–’æ™ƒ â” å›é£¯åº—", detail: "ä¼‘æ¯ã€‚", todos: ["è¨˜å¸³"], map: "æµ·èŒµå¨œé£¯åº—ä»™å°åœ‹åˆ†ç”º", expenses: [] }
        ]},
        { date: "3/8 (æ—¥)", steps: [
            { time: "09:30 - 12:30", name: "å‡ºé–€ â” é€›è¡— â” åˆé¤", detail: "ä»™å°æœ€å¾Œæ¡è²·ã€‚", todos: ["æ”¶å¥½æˆ°åˆ©å“"], map: "ä»™å°", expenses: [] },
            { time: "12:30 - 14:30", name: "æ‹†å¤¥ â” é‡‘è›‡æ°´ç¥ç¤¾ â” å‰å¾€å²©æ²¼", detail: "åƒæ‹œé‡‘è›‡æ°´ç¥ç¤¾ã€‚", todos: ["è²·å¾¡å®ˆ"], map: "é‡‘è›‡æ°´ç¥ç¤¾", expenses: [] },
            { time: "15:21 - 18:30", name: "å²©æ²¼ â” éƒ¡å±± â” æŠµé”æœƒæ´¥è‹¥æ¾", detail: "æ­æ–°å¹¹ç·šè½‰ JR æŠµé”æœƒæ´¥ã€‚", todos: ["è½‰ä¹˜ç¢ºèª"], map: "ä¼šæ´¥è‹¥æ¾é§…", expenses: [] },
            { time: "19:00 - 20:30", name: "å…¥ä½é£¯åº— â” æ™šé¤ â” ä¼‘æ¯", detail: "å®¿æœƒæ´¥è‹¥æ¾ã€‚", todos: ["Check-in"], map: "ä¼šæ´¥è‹¥æ¾", expenses: [] }
        ]},
        { date: "3/9 (ä¸€)", steps: [
            { time: "05:20 - 07:21", name: "å‡ºé–€ â” æœƒæ´¥è‹¥æ¾ç«™ â” åªè¦‹ç·š", detail: "æ­é¦–ç­è»Š 05:50 å‡ºç™¼ã€‚", todos: ["æº–æ™‚èµ·åºŠ"], map: "ä¼šæ´¥è‹¥æ¾é§…", expenses: [] },
            { time: "09:00 - 11:10", name: "å±•æœ›å°æ‹ç…§ â” å›æœƒæ´¥å®®ä¸‹", detail: "æ‹ 09:30 çš„ç«è»Šã€‚", todos: ["æ‹å¥½éµæ©‹"], map: "ç¬¬ä¸€åªè¦‹å·æ©‹æ¢å±•æœ›å°", expenses: [] },
            { time: "11:10 - 20:00", name: "å›æœƒæ´¥è‹¥æ¾ â” å–œå¤šæ–¹æ‹‰éºµ â” æ™šé¤", detail: "åƒæ‹‰éºµã€å¸‚å€é–’æ™ƒã€‚", todos: ["åƒå–œå¤šæ–¹æ‹‰éºµ"], map: "å–œå¤šæ–¹é§…", expenses: [] }
        ]},
        { date: "3/10 (äºŒ)", steps: [
            { time: "08:00 - 13:10", name: "å‡ºé–€ â” è²“é­”æ»‘é›ªå ´ â” æ»‘é›ªçµæŸ", detail: "é›ªå ´ç·´åŠŸã€‚", todos: ["æ»‘é›ªç·´ç¿’"], map: "è²“é­”æ»‘é›ªå ´", expenses: [] },
            { time: "15:52 - 18:50", name: "æ­è»Šå¾€é¬¼æ€’å· â” æŠµé”æ—¥å…‰ç«™", detail: "æ­ AIZU Mount Express ç›´é”ã€‚", todos: ["å–è¡Œæ"], map: "æ±æ­¦æ—¥å…‰é§…", expenses: [] },
            { time: "19:00 - 21:00", name: "å…¥ä½æ—¥å…‰é£¯åº— â” æ™šé¤ â” ä¼‘æ¯", detail: "ä¼‘æ¯ã€‚", todos: ["Check-in"], map: "æ—¥å…‰", expenses: [] }
        ]},
        { date: "3/11 (ä¸‰)", steps: [
            { time: "09:30 - 11:00", name: "æ±ç…§å®® â” äºŒè’å±±ç¥ç¤¾ â” å¾€æ±äº¬", detail: "ä¸–ç•Œéºç”¢åƒæ‹œã€‚", todos: ["æ‹æ±ç…§å®®"], map: "æ—¥å…‰æ±ç…§å®®", expenses: [] },
            { time: "13:00 - 18:00", name: "æŠµé”æ±äº¬ â” å°ç¶²ç¥ç¤¾ â” ç¾è¡“é¤¨", detail: "å°ç¶²ç¥ç¤¾æ´—éŒ¢ã€å¢¨ç”°åŒ—é½‹ç¾è¡“é¤¨ã€‚", todos: ["æ´—éŒ¢"], map: "å°ç¶²ç¥ç¤¾", expenses: [] },
            { time: "18:00 - 21:00", name: "ä¸€ç•ªè¡— â” å…¥ä½é£¯åº— â” ä¼‘æ¯", detail: "æ™šé¤ã€‚", todos: ["Check-in"], map: "æ–°å®¿", expenses: [] }
        ]},
        { date: "3/12 (å››)", steps: [
            { time: "09:30 - 13:55", name: "åœ°ä¸‹å®®æ®¿ â” æ˜¥æ—¥éƒ¨ â” å›æ±äº¬", detail: "12:30 åœ°ä¸‹å®®æ®¿å ±åˆ°ã€‚", todos: ["åœ°ä¸‹å®®æ®¿é ç´„å–®"], map: "é¦–éƒ½åœå¤–éƒ­æ”¾æ°´è·¯", expenses: [] },
            { time: "14:00 - 21:00", name: "å¦™ç¾©ç¥ç¤¾ â” ä¸­é‡ â” æ™šé¤ â” ä¼‘æ¯", detail: "ä¸­é‡ç™¾è€åŒ¯æŒ–å¯¶ã€‚", todos: ["è²·å…¬ä»”"], map: "ä¸­é‡ç™¾è€åŒ¯", expenses: [] }
        ]},
        { date: "3/13 (äº”)", steps: [
            { time: "09:30 - 12:00", name: "å¯„è¡Œæ â” å‰ç¥¥å¯º â” é–’é€›", detail: "è¡Œææ”¾æ–°å®¿ã€‚", todos: ["å¯„ç‰©æ«ƒä½ç½®"], map: "å‰ç¥¥å¯º", expenses: [] },
            { time: "12:00 - 17:00", name: "é˜¿ä½å¤ç¥æ˜å®® â” ä¸­é‡ â” ä¸‹åŒ—æ¾¤", detail: "å¤§æ¡è²·ã€‚", todos: ["è²·å¾¡å®ˆ"], map: "é˜¿ä½ãƒ¶è°·ç¥æ˜å®®", expenses: [] },
            { time: "18:39 - 22:30", name: "æ–°å®¿ N'EX â” æŠµé”æ©Ÿå ´ â” é£›æ©Ÿ", detail: "å›å®¶ã€‚", todos: ["è­·ç…§æº–å‚™"], map: "æˆç”°æ©Ÿå ´", expenses: [] }
        ]}
    ];

    let tripData = JSON.parse(localStorage.getItem('trip_full_db_v4')) || defaultTrip;

    function renderList() {
        const container = document.getElementById('main-view');
        container.innerHTML = '';
        tripData.forEach((day, dIdx) => {
            let html = `<div class="day-group"><div class="day-title"><span>${day.date}</span></div>`;
            day.steps.forEach((s, sIdx) => {
                html += `
                <div class="step-card">
                    <div class="step-header" onclick="toggleBody(${dIdx}, ${sIdx})">
                        <div class="step-time">${s.time}</div>
                        <div class="step-name">${s.name}</div>
                    </div>
                    <div class="step-body" id="body-${dIdx}-${sIdx}">
                        ${isEditMode ? renderEditor(dIdx, sIdx, s) : renderViewer(dIdx, sIdx, s)}
                    </div>
                </div>`;
            });
            html += `</div>`;
            container.innerHTML += html;
        });
        localStorage.setItem('trip_full_db_v4', JSON.stringify(tripData));
    }

    function renderViewer(dIdx, sIdx, s) {
        return `
            <div class="section-title">ğŸ“ è©³ç´°å‚™è¨»</div>
            <div style="font-size:0.9rem; white-space:pre-wrap;">${s.detail}</div>
            <div class="section-title">âœ… ä»£è¾¦</div>
            <div>${s.todos.map(t => `<div class="todo-item"><input type="checkbox"> ${t}</div>`).join('')}</div>
            <div class="section-title">ğŸ’¸ è¨˜å¸³</div>
            <div id="exp-list-${dIdx}-${sIdx}">${s.expenses.map(e => `<div class="exp-list-item"><span>${e.cat}: ${e.amt} JPY</span><span>$${Math.round(e.amt * rate)}</span></div>`).join('')}</div>
            <a class="btn" style="display:inline-block; margin-top:10px; text-decoration:none;" href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.map)}" target="_blank">ğŸ“ åœ°åœ–æœå°‹</a>
        `;
    }

    function renderEditor(dIdx, sIdx, s) {
        return `
            æ™‚é–“: <input class="edit-input" value="${s.time}" onchange="update(${dIdx}, ${sIdx}, 'time', this.value)">
            åç¨±: <input class="edit-input" value="${s.name}" onchange="update(${dIdx}, ${sIdx}, 'name', this.value)">
            å‚™è¨»: <textarea class="edit-input" onchange="update(${dIdx}, ${sIdx}, 'detail', this.value)">${s.detail}</textarea>
            è¨˜å¸³: <div style="display:flex;gap:4px;"><input id="amt-${dIdx}-${sIdx}" type="number" placeholder="é‡‘é¡" style="width:70px"><input id="cat-${dIdx}-${sIdx}" type="text" placeholder="é¡åˆ¥" style="width:70px"><button onclick="addExp(${dIdx},${sIdx})">åŠ </button></div>
        `;
    }

    function toggleBody(dIdx, sIdx) { document.getElementById(`body-${dIdx}-${sIdx}`).classList.toggle('active'); }
    function toggleEdit() { isEditMode = !isEditMode; renderList(); }
    function update(dIdx, sIdx, key, val) { tripData[dIdx].steps[sIdx][key] = val; localStorage.setItem('trip_full_db_v4', JSON.stringify(tripData)); }
    function addExp(dIdx, sIdx) {
        const amt = document.getElementById(`amt-${dIdx}-${sIdx}`).value;
        const cat = document.getElementById(`cat-${dIdx}-${sIdx}`).value;
        if(amt) { tripData[dIdx].steps[sIdx].expenses.push({cat: cat||'ä¸€èˆ¬', amt: parseFloat(amt)}); renderList(); }
    }
    function showTab(tab) {
        document.getElementById('main-view').classList.toggle('hidden', tab !== 'main');
        document.getElementById('summary-view').classList.toggle('hidden', tab !== 'sum');
        if(tab === 'sum') renderSum();
    }
    function renderSum() {
        let totals = {};
        tripData.forEach(d => d.steps.forEach(s => s.expenses.forEach(e => { totals[e.cat] = (totals[e.cat] || 0) + e.amt; })));
        let html = '';
        for(let cat in totals) { html += `<div class="exp-list-item"><span>${cat}</span><span>ï¿¥${totals[cat]} / $${Math.round(totals[cat]*rate)}</span></div>`; }
        document.getElementById('sum-stats').innerHTML = html || 'å°šç„¡è³‡æ–™';
    }
    renderList();
</script>
</body>
</html>